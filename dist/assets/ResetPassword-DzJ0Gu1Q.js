import{u as E,a4 as z,r as t,j as e,L,g as A,a as p,x as f,a5 as b,s as g,J as o}from"./index-EUBTzQul.js";import{I as v}from"./input-BXL43AC-.js";import{A as T,a as q}from"./alert-DCklxFGe.js";import{E as j}from"./eye-off-DmWqI3bT.js";const J=()=>{const k=E();z();const[n,y]=t.useState(""),[w,N]=t.useState(""),[c,P]=t.useState(!1),[d,S]=t.useState(!1),[u,m]=t.useState(!1),[x,r]=t.useState(""),[C,R]=t.useState(!1),[F,l]=t.useState(!1);t.useEffect(()=>{(async()=>{const s=window.location.hash&&window.location.hash.includes("access_token");if(console.log("URL hash check:",{hash:window.location.hash,hasToken:s}),R(s),s)try{const{data:i,error:h}=await g.auth.getSession();console.log("Session check result:",{hasSession:!!i.session,error:h}),h?(console.error("Recovery token processing error:",h),r("Invalid or expired password reset link"),o.error("Invalid or expired password reset link"),l(!1)):i.session?(console.log("Recovery token processed successfully"),l(!0)):(console.error("No session found after processing recovery token"),r("Invalid or expired password reset link"),o.error("Invalid or expired password reset link"),l(!1))}catch(i){console.error("Error processing recovery token:",i),r("Failed to process recovery token"),l(!1)}else console.log("No recovery hash found in URL"),r("Invalid or expired password reset link"),o.error("Invalid or expired password reset link"),l(!1)})()},[]);const I=async a=>{if(a.preventDefault(),r(""),n!==w){r("Passwords do not match");return}if(n.length<6){r("Password must be at least 6 characters long");return}m(!0);try{const{error:s}=await g.auth.updateUser({password:n});s?(console.error("Password update error:",s),r(s.message),o.error(s.message||"Failed to reset password")):(o.success("Password updated successfully"),setTimeout(()=>{k("/login")},1500))}catch(s){console.error("Password reset error:",s),r("An unexpected error occurred"),o.error("An unexpected error occurred")}finally{m(!1)}};return e.jsx(L,{children:e.jsxs("div",{className:"w-screen h-screen flex items-center justify-center relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("img",{src:"/lovable-uploads/067c7b04-b1a2-4236-97eb-2b7cf8b24291.png",alt:"Background",className:"w-full h-full object-cover filter brightness-50"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"})]}),e.jsxs("div",{className:"w-full max-w-md px-4 relative z-10",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-white",children:"Set New Password"}),e.jsx("p",{className:"text-white/90 font-medium",children:"Create a new secure password for your account"})]}),e.jsx("div",{className:"glass-card rounded-xl shadow-xl border border-white/10 p-8 animate-scale-in backdrop-blur-lg bg-white/10",children:!C||x?e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{className:"bg-red-500/20 border-red-300/30",children:e.jsx(q,{className:"text-white",children:x||"Invalid or expired password reset link. Please request a new password reset."})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(A,{to:"/forgot-password",children:e.jsx(p,{className:"bg-orange-500 hover:bg-orange-600 text-white",children:"Request New Reset Link"})})})]}):e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-white mb-1",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{id:"password",type:c?"text":"password",value:n,onChange:a=>y(a.target.value),placeholder:"Enter new password",className:"pl-10 bg-white/10 border-black/20 text-white placeholder:text-white/60 placeholder:font-medium focus:border-black/40 focus:ring-black/20 hover:bg-white/20 transition-all duration-300",required:!0}),e.jsx(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white"}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-white hover:text-white/70 transition-colors",onClick:()=>P(!c),children:c?e.jsx(j,{size:16}):e.jsx(b,{size:16})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-white mb-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{id:"confirmPassword",type:d?"text":"password",value:w,onChange:a=>N(a.target.value),placeholder:"Confirm new password",className:"pl-10 bg-white/10 border-black/20 text-white placeholder:text-white/60 placeholder:font-medium focus:border-black/40 focus:ring-black/20 hover:bg-white/20 transition-all duration-300",required:!0}),e.jsx(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white"}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-white hover:text-white/70 transition-colors",onClick:()=>S(!d),children:d?e.jsx(j,{size:16}):e.jsx(b,{size:16})})]})]}),e.jsx(p,{type:"submit",className:"w-full bg-orange-500 hover:bg-orange-600 text-white transition-all duration-300 hover:shadow-lg hover:shadow-orange-300/50 animate-fade-in",disabled:u,children:u?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating..."]}):"Reset Password"})]})})]})]})})};export{J as default};
