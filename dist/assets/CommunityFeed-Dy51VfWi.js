import{n as T,aR as P,r as h,j as e,a2 as X,B as w,_ as F,av as O,af as U,J as y,U as E}from"./index-DmiwH21i.js";import{I as C}from"./input-BAgFuN3B.js";import{t as f,c as J,e as L,g as _,m as k,a as N,b as Y}from"./en-US-CXXYYhpC.js";import{e as R,d as H}from"./endOfMonth-CkEvJJVO.js";import{M as q}from"./message-square-B5gb5CvZ.js";import{T as B}from"./textarea-BBDyVfad.js";import{L as M}from"./label-QTYrxBzu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=T("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=T("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),W="https://abxrphctohxctpmaozvc.supabase.co",Z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFieHJwaGN0b2h4Y3RwbWFvenZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4MTIyNDgsImV4cCI6MjA2MTM4ODI0OH0.BHT8zdD4IuSrEzybqXxuADFB903FBl0f0C_yC7lSe_Q",p=P(W,Z);function v(t,n){const r=f(t),l=f(n),a=r.getTime()-l.getTime();return a<0?-1:a>0?1:a}function G(t){return J(t,Date.now())}function V(t){return n=>{const l=(t?Math[t]:Math.trunc)(n);return l===0?0:l}}function Q(t,n){return+f(t)-+f(n)}function $(t){const n=f(t);return n.setHours(23,59,59,999),n}function K(t){const n=f(t);return+$(n)==+R(n)}function ee(t,n){const r=f(t),l=f(n),a=v(r,l),m=Math.abs(H(r,l));let c;if(m<1)c=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*m);let s=v(r,l)===-a;K(f(t))&&m===1&&v(t,l)===1&&(s=!1),c=a*(m-Number(s))}return c===0?0:c}function te(t,n,r){const l=Q(t,n)/1e3;return V(r==null?void 0:r.roundingMethod)(l)}function se(t,n,r){const l=Y(),a=(r==null?void 0:r.locale)??l.locale??L,m=2520,c=v(t,n);if(isNaN(c))throw new RangeError("Invalid time value");const s=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:c});let d,u;c>0?(d=f(n),u=f(t)):(d=f(t),u=f(n));const g=te(u,d),i=(_(u)-_(d))/1e3,o=Math.round((g-i)/60);let b;if(o<2)return r!=null&&r.includeSeconds?g<5?a.formatDistance("lessThanXSeconds",5,s):g<10?a.formatDistance("lessThanXSeconds",10,s):g<20?a.formatDistance("lessThanXSeconds",20,s):g<40?a.formatDistance("halfAMinute",0,s):g<60?a.formatDistance("lessThanXMinutes",1,s):a.formatDistance("xMinutes",1,s):o===0?a.formatDistance("lessThanXMinutes",1,s):a.formatDistance("xMinutes",o,s);if(o<45)return a.formatDistance("xMinutes",o,s);if(o<90)return a.formatDistance("aboutXHours",1,s);if(o<k){const x=Math.round(o/60);return a.formatDistance("aboutXHours",x,s)}else{if(o<m)return a.formatDistance("xDays",1,s);if(o<N){const x=Math.round(o/k);return a.formatDistance("xDays",x,s)}else if(o<N*2)return b=Math.round(o/N),a.formatDistance("aboutXMonths",b,s)}if(b=ee(u,d),b<12){const x=Math.round(o/N);return a.formatDistance("xMonths",x,s)}else{const x=b%12,j=Math.trunc(b/12);return x<3?a.formatDistance("aboutXYears",j,s):x<9?a.formatDistance("overXYears",j,s):a.formatDistance("almostXYears",j+1,s)}}function ae(t,n){return se(t,G(t),n)}function re({post:t}){const[n,r]=h.useState([]),[l,a]=h.useState(""),[m,c]=h.useState(""),[s,d]=h.useState(!1);h.useEffect(()=>{s&&u()},[s]);async function u(){const{data:i}=await p.from("comments").select("*").eq("post_id",t.id).order("created_at",{ascending:!0});i&&r(i)}const g=async i=>{if(i.preventDefault(),!l.trim()||!m.trim())return;const{error:o}=await p.from("comments").insert([{post_id:t.id,guest_name:m,content:l}]);o||(a(""),u())};return e.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:t.guest_name}),e.jsx("p",{className:"text-xs text-gray-500",children:ae(new Date(t.created_at),{addSuffix:!0})})]})]}),e.jsx("p",{className:"text-gray-800 mb-4 whitespace-pre-wrap",children:t.content}),t.media_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-black",children:t.media_type==="video"?e.jsx("video",{src:t.media_url,controls:!0,className:"w-full max-h-[400px] object-contain"}):e.jsx("img",{src:t.media_url,alt:"Post media",className:"w-full max-h-[400px] object-cover"})}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("button",{onClick:()=>d(!s),className:"flex items-center gap-1 text-sm text-gray-500 hover:text-blue-600",children:[e.jsx(q,{className:"w-4 h-4"}),s?"Hide Comments":"Show Comments"]})})]}),s&&e.jsxs("div",{className:"bg-gray-50 p-4 border-t",children:[e.jsxs("div",{className:"space-y-3 mb-4 max-h-60 overflow-y-auto",children:[n.map(i=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-bold",children:[i.guest_name,": "]}),e.jsx("span",{className:"text-gray-700",children:i.content})]},i.id)),n.length===0&&e.jsx("p",{className:"text-xs text-gray-400",children:"No comments yet."})]}),e.jsxs("form",{onSubmit:g,className:"space-y-2",children:[e.jsx(C,{placeholder:"Your Name",value:m,onChange:i=>c(i.target.value),className:"text-xs h-8"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{placeholder:"Write a comment...",value:l,onChange:i=>a(i.target.value),className:"text-xs h-8"}),e.jsx(w,{type:"submit",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(F,{className:"w-3 h-3"})})]})]})]})]})}function ne({onClose:t,onPost:n}){const[r,l]=h.useState(""),[a,m]=h.useState(""),[c,s]=h.useState(null),[d,u]=h.useState(!1),g=async i=>{if(i.preventDefault(),!r.trim()||!a.trim()){y.error("Name and Content are required");return}u(!0);try{let o=null,b=null;if(c){const j=c.name.split(".").pop(),D=`${Date.now()}.${j}`,{error:I}=await p.storage.from("community-media").upload(D,c);if(I)console.error("Upload error:",I),y.warning("Could not upload image. Posting text only.");else{const{data:z}=p.storage.from("community-media").getPublicUrl(D);o=z.publicUrl,b=c.type.startsWith("video")?"video":"image"}}const{error:x}=await p.from("posts").insert([{guest_name:r,content:a,media_url:o,media_type:b}]);if(x)throw x;y.success("Post shared successfully!"),n(),t()}catch(o){console.error("Error posting:",o),y.error(o.message||"Failed to post")}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md p-6 relative shadow-2xl",children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-700 transition-colors",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl font-bold mb-1 text-gray-900",children:"Share Your Story"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Tell the community about your legal journey."}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"guestName",children:"Your Name (Public)"}),e.jsx(C,{id:"guestName",value:r,onChange:i=>l(i.target.value),placeholder:"e.g. John Doe",disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"content",children:"Your Story"}),e.jsx(B,{id:"content",value:a,onChange:i=>m(i.target.value),placeholder:"What's on your mind?",rows:4,className:"resize-none",disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"media",children:"Attach Media (Optional)"}),e.jsxs("div",{className:"border border-dashed border-gray-300 rounded-lg p-4 hover:bg-gray-50 transition-colors cursor-pointer relative",children:[e.jsx("input",{id:"media",type:"file",accept:"image/*,video/*",onChange:i=>{var o;return s(((o=i.target.files)==null?void 0:o[0])||null)},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:d}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600",children:[e.jsx(A,{className:"w-4 h-4"}),c?e.jsx("span",{className:"text-blue-600 font-medium truncate max-w-[200px]",children:c.name}):e.jsx("span",{children:"Click to upload image or video"})]})]})]}),e.jsx(w,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 mt-2",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 animate-spin mr-2"}),"Posting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Post Story"]})})]})]})})}const he=()=>{const[t,n]=h.useState([]),[r,l]=h.useState(!0),[a,m]=h.useState(!1),c=async()=>{l(!0);const{data:s,error:d}=await p.from("posts").select("*").order("created_at",{ascending:!1});!d&&s&&n(s),l(!1)};return h.useEffect(()=>{c();const s=p.channel("public:posts").on("postgres_changes",{event:"INSERT",schema:"public",table:"posts"},d=>{n(u=>[d.new,...u])}).subscribe();return()=>{p.removeChannel(s)}},[]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-100/60 via-indigo-100/60 to-white flex items-center justify-center py-8",children:e.jsxs("div",{className:"w-full max-w-3xl bg-white/90 rounded-3xl shadow-2xl p-4 sm:p-8 md:p-12 border border-blue-200/40 backdrop-blur-md mx-2",children:[e.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-400 via-indigo-400 to-blue-600 p-4 rounded-full shadow-lg",children:e.jsx(E,{className:"w-9 h-9 text-white drop-shadow"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold text-blue-900 mb-2 tracking-tight drop-shadow",children:"Community"}),e.jsx("p",{className:"text-indigo-700 text-lg md:text-xl font-medium mb-1",children:"Welcome to the Legalgram Community!"}),e.jsx("p",{className:"text-blue-700 text-base md:text-lg",children:"Share your legal journey, ask questions, and connect with others. This is a safe, supportive space for everyone."})]})]}),e.jsxs(w,{onClick:()=>m(!0),className:"flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-7 py-3 rounded-xl shadow-xl hover:from-blue-600 hover:to-indigo-700 text-lg font-semibold border-2 border-blue-200/40",size:"lg",children:[e.jsx(S,{className:"w-6 h-6"})," New Post"]}),e.jsx("div",{className:"absolute -top-8 -right-8 w-24 h-24 bg-gradient-to-br from-blue-200 via-indigo-200 to-white rounded-full blur-2xl opacity-40 pointer-events-none"})]}),a&&e.jsx(ne,{onClose:()=>m(!1),onPost:c}),r?e.jsx("div",{className:"flex justify-center py-16",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]})}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-6 mb-4",children:e.jsx(S,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-blue-500 mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-blue-400 mb-4",children:"Be the first to share your legal experience or ask a question."}),e.jsxs(w,{onClick:()=>m(!0),className:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-2 rounded-lg shadow hover:from-blue-600 hover:to-indigo-700",children:[e.jsx(S,{className:"w-4 h-4 mr-2"})," Create First Post"]})]}):e.jsx("div",{className:"space-y-8",children:t.map(s=>e.jsx(re,{post:s},s.id))})]})})};export{he as default};
